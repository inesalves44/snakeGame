<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        canvas {
            border: 1px solid #d3d3d3;
            background-color: #f1f1f1;
        }
    </style>
</head>
<body onload="startGame()">
    <script>
        var snake = [];
        var element = {};
        var xElement;
        var yElement;
        var speedX = 5;
        var speedY = 0;
        var interval;
        var begin = 1;
        var crash = false;

        /*Function to start the game*/
        function startGame() {

            myGameArea.start();

            if (begin == 1) {
                createSnake();
                begin++;
            }

            xElement = Math.floor(Math.random() * myGameArea.canvas.width);
            yElement = Math.floor(Math.random() * myGameArea.canvas.height);
            createElement(xElement, yElement);
            interval = setInterval(updateGameArea, 50);
        }


        //creates the game area
        var myGameArea = {
            //canvas document
            canvas: document.createElement("canvas"),
            //starts the canvas
            start: function () {
                this.canvas.width = 480;
                this.canvas.height = 270;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                window.addEventListener('keydown', function (e) {
                    myGameArea.key = e.key;
                })
                window.addEventListener('keyup', function (e) {
                    myGameArea.key = false;
                })
            },
            clear: function () {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            },
            stop: function () {
                clearInterval(this.interval);
            }
        }

        //creates the array for the snake
        function createSnake() {
            var xInicial = 240;
            var yInicial = 135;

            for (var i = 0; i < 15; i++) {
                snake.unshift(new drawSnakePart(xInicial + (i * 5), yInicial, 'black'));
            }
        }

        //draw elements in the canvas
        function draw(test) {
            var ctx = myGameArea.context;

            ctx.fillStyle = test.color;
            ctx.fillRect(test.x, test.y, test.width, test.height);
            ctx.strokeStyle = test.border;
            ctx.strokeRect(test.x, test.y, test.width, test.height);
        }

        //draws each element of the array snake
        function drawSnakePart(x, y, color) {
            this.width = 5;
            this.height = 5;
            this.x = x;
            this.y = y;
            this.speedX = speedX;
            this.speedY = speedY;
            this.color = color;
            this.border = color;
            draw(this);
        }

        //create the element for the snake to eat
        function createElement(xElement, yElement) {

            element.width = 3;
            element.height = 3;
            element.color = 'black';
            element.border = 'black';
            element.x = xElement;
            element.y = yElement;
            draw(element);
        }

        //let's the snake go thorough walls
        function treatWalls(newHeadX, newHeadY) {
            if (newHeadX == myGameArea.canvas.width)
                newHeadX = 0;
            else if (newHeadX == 0)
                newHeadX = myGameArea.canvas.width - 5;
            else if (newHeadY == myGameArea.canvas.height)
                newHeadY = 0;
            else if (newHeadY == 0)
                newHeadY = myGameArea.canvas.height - 5;
            return new drawSnakePart(newHeadX, newHeadY, 'black');
        }

        //checks the arrow events
        function getEvents() {
            if (myGameArea.key && myGameArea.key === "ArrowLeft" && speedX == 0) {
                speedX = -5;
                speedY = 0;
            }
            else if (myGameArea.key && myGameArea.key === "ArrowRight" && speedX == 0) {
                speedX = 5;
                speedY = 0;
            }
            else if (myGameArea.key && myGameArea.key === "ArrowUp" && speedY == 0) {
                speedY = -5;
                speedX = 0;
            }
            else if (myGameArea.key && myGameArea.key === "ArrowDown" && speedY == 0) {
                speedY = 5;
                speedX = 0;
            }
        }

        //check if the snake ate
        function checkEating() {
            var head = snake[0];
            var headX = head.x;
            var headY = head.y;
            var elementX = element.x;
            var elementY = element.y;
            var elementWidth = element.width;
            var elementHeight = element.height;

            if (headX < elementX + elementWidth && headX + head.width > elementX && headY < elementY + elementHeight &&
                headY + head.height > elementY) {
                xElement = Math.floor(Math.random() * (myGameArea.canvas.width - 30));
                yElement = Math.floor(Math.random() * (myGameArea.canvas.height - 30));
                snake.push(new drawSnakePart(snake[snake.length - 1].x + speedX, snake[snake.length - 1].y + speedY, 'black'));
            } else {
                snake.pop();
            }
            return snake;
        }

        //checks if the snake collided with it self
        function checkCrash() {
            var head = snake[0];
            var headX = head.x;
            var headY = head.y;

            for (var i = 1; i < snake.length; i++) {
                if (headX === snake[i].x && headY === snake[i].y) {
                    console.log("Crashed!");
                    crash = true;
                    break ;
                }
            }
        }

        //updates the game by adding a new head, checking if the snake has eaten and drwas the new snake and element
        function updateGameArea() {

            myGameArea.clear();

            getEvents();
            checkCrash();

            if (crash == true) {
                clearInterval(interval);
                myGameArea.stop();
                return;
            }

            var head = snake[0];
            var newHeadX = head.x + head.speedX;
            var newHeadY = head.y + head.speedY;

            newHead = treatWalls(newHeadX, newHeadY, head);

            snake.unshift(newHead);

            snake = checkEating();

            for (var i = 1; i < snake.length; i++) {
                draw(snake[i]);
            }

            createElement(xElement, yElement);
        }

        startGame();

    </script>
</body>
</html>